---
import Footer from "../components/footer.astro";
import Header from "../components/header.astro";
import SquareLines from "../components/square-lines.astro";

const { title = "Muhammad Ishaq", showContact = false } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <link rel="icon" type="image/png" href="/assets/images/favicon.png" />

    <!-- Prevent flash of wrong theme -->
    <script is:inline>
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const darkModeStorage = localStorage.getItem("dark_mode");
      if (darkModeStorage === "true" || (darkModeStorage === null && prefersDark)) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>

    <style>
      /* ðŸŒˆ Define site-wide theme variables */
      :root {
        --color-bg: #ffffff;
        --color-text: #404040;
        --color-accent: #2563eb; /* blue accent default */
        --color-border: #d1d5db;
      }

      .dark {
        --color-bg: #0f0e0e;
        --color-text: #e5e5e5;
        --color-accent: #facc15; /* yellow accent for dark mode */
        --color-border: #374151;
      }

      body {
        background-color: var(--color-bg);
        color: var(--color-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      main {
        flex: 1;
      }

      .prose img {
        border-radius: 20px;
      }
    </style>

    <Fragment set:html={import.meta.env.HEADER_INJECT} />
  </head>

  <body class="antialiased transition-colors duration-300">
    <SquareLines />
    <Header />

    <main>
      <!-- This renders the main page content -->
      <slot />

      <!-- Only show contact section when enabled -->
      {showContact ? (
        <section
          class="max-w-xl mx-auto my-12 p-8 rounded-lg shadow-lg border transition-colors duration-300"
          style="
            background-color: var(--color-bg);
            border-color: var(--color-border);
            color: var(--color-text);
          "
        >
          <h2 class="text-3xl font-bold mb-2" style="color: var(--color-accent);">
            Contact Me
          </h2>

          <p class="mb-6 text-lg opacity-90">
            Let's talk â€” I'm currently open for new opportunities.
          </p>

          <form
            id="contactForm"
            action="https://formspree.io/f/mvgwqzka"
            method="POST"
            class="space-y-4"
          >
            <div>
              <label for="name" class="block mb-1 font-semibold">Your Name</label>
              <input
                type="text"
                id="name"
                name="name"
                placeholder="Enter your name"
                class="w-full p-3 rounded border focus:outline-none focus:ring-2 transition-all"
                style="
                  background-color: var(--color-bg);
                  color: var(--color-text);
                  border-color: var(--color-border);
                  caret-color: var(--color-accent);
                "
                required
              />
            </div>

            <div>
              <label for="email" class="block mb-1 font-semibold">Your Email</label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="Enter your email"
                class="w-full p-3 rounded border focus:outline-none focus:ring-2 transition-all"
                style="
                  background-color: var(--color-bg);
                  color: var(--color-text);
                  border-color: var(--color-border);
                  caret-color: var(--color-accent);
                "
                required
              />
            </div>

            <div>
              <label for="message" class="block mb-1 font-semibold">Message</label>
              <textarea
                id="message"
                name="message"
                rows="5"
                placeholder="Write your message here..."
                class="w-full p-3 rounded border focus:outline-none focus:ring-2 transition-all"
                style="
                  background-color: var(--color-bg);
                  color: var(--color-text);
                  border-color: var(--color-border);
                  caret-color: var(--color-accent);
                "
                required
              ></textarea>
            </div>

            <input type="hidden" name="_subject" value="New message from your portfolio website!" />
            <input type="text" name="_gotcha" style="display:none" />

            <button
              type="submit"
              class="font-bold px-6 py-3 rounded transition-colors w-full"
              style="
                background-color: var(--color-accent);
                color: var(--color-bg);
              "
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              Send Message
            </button>
          </form>

          <!-- Thank You Popup -->
          <div
            id="thankYouPopup"
            style="display:none;"
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
          >
            <div
              class="p-8 rounded-lg shadow-lg text-center transition-colors duration-300"
              style="
                background-color: var(--color-bg);
                color: var(--color-accent);
              "
            >
              <h3 class="text-2xl font-bold mb-2">Thank you!</h3>
              <p>Your message has been sent.</p>
              <button
                onclick="document.getElementById('thankYouPopup').style.display='none'"
                class="mt-4 px-4 py-2 rounded transition-colors"
                style="
                  background-color: var(--color-accent);
                  color: var(--color-bg);
                "
              >
                Close
              </button>
            </div>
          </div>

          <script is:inline>
            document.addEventListener('DOMContentLoaded', function() {
              const form = document.getElementById('contactForm');
              form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const data = new FormData(form);
                const action = form.action;
                await fetch(action, {
                  method: 'POST',
                  body: data,
                  headers: { 'Accept': 'application/json' }
                });
                form.reset();
                document.getElementById('thankYouPopup').style.display = 'flex';
              });
            });
          </script>
        </section>
      ) : null}
    </main>

    <Footer />
    <script src="../assets/js/main.js"></script>
    <Fragment set:html={import.meta.env.FOOTER_INJECT} />
  </body>
</html>
