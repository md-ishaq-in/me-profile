---
const { success = false, error = '' } = Astro.props;
---

<section class="max-w-xl mx-auto my-12 p-8 bg-white/5 rounded-lg shadow-lg">
  <h2 class="text-3xl font-bold mb-2 text-yellow-400">Contact Me</h2>
  <p class="mb-6 text-lg">Let's talk — I'm currently open for new opportunities.</p>

  {success ? (
    <div class="bg-green-600 p-3 rounded">✅ Message sent successfully!</div>
  ) : (
    <>
      {error && <div class="bg-red-600 p-3 rounded mb-4">❌ {error}</div>}
      <form id="contactForm" class="space-y-4">
        <div>
          <label for="name" class="block mb-1 font-semibold">Your Name</label>
          <input type="text" id="name" name="name" class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600" required />
        </div>
        <div>
          <label for="email" class="block mb-1 font-semibold">Your Email</label>
          <input type="email" id="email" name="email" class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600" required />
        </div>
        <div>
          <label for="message" class="block mb-1 font-semibold">Message</label>
          <textarea id="message" name="message" rows="4" class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600" required></textarea>
        </div>
        <button type="submit" class="bg-yellow-400 text-black font-bold px-6 py-2 rounded hover:bg-yellow-500">Send Message</button>
      </form>
      <div id="formStatus" class="mt-4"></div>
    </>
  )}
</section>

<script>
  document.querySelector("#contactForm").addEventListener("submit", async (e) => {
    e.preventDefault(); // stop the reload
    const status = document.querySelector("#formStatus");
    status.textContent = "⏳ Sending message...";

    const formData = new FormData(e.target);
    const name = formData.get("name");
    const email = formData.get("email");
    const message = formData.get("message");

    try {
      const res = await fetch("/api/send-email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, message }),
      });

      if (res.ok) {
        status.textContent = "✅ Message sent successfully!";
        e.target.reset();
      } else {
        status.textContent = "❌ Failed to send message.";
      }
    } catch (err) {
      console.error(err);
      status.textContent = "⚠️ Error sending message.";
    }
  });
</script>
