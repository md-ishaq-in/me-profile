---
export const prerender = true;

import { getCollection } from "astro:content";
import PostLayout from "../../layouts/post.astro";
import { calculateReadingTime } from "../../utils/blog";

export async function getStaticPaths() {
  const postEntries = await getCollection("post");

  // Log for debugging (optional)
  console.log("‚úÖ Loaded posts:", postEntries.length);

  return postEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;

// üß† Safety check to avoid the "undefined render" error
if (!entry) {
  throw new Error("‚ùå No post entry found for this slug.");
}

const { Content } = await entry.render();

const readingTime = calculateReadingTime(entry.body);

const frontmatter = {
  ...entry.data,
  readingTime,
  dateFormatted: entry.data.date
    ? new Date(entry.data.date).toLocaleDateString("en-us", {
        year: "numeric",
        month: "short",
        day: "numeric",
      })
    : "",
};
---

<PostLayout frontmatter={frontmatter}>
  <Content />
</PostLayout>
