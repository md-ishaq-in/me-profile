---
import Layout from "../layouts/main.astro";
import ContactForm from "../components/contact-form.astro";

let success = false;
let error = '';

if (Astro.request.method === 'POST') {
  try {
    const formData = await Astro.request.formData();
    const name = formData.get('name');
    const email = formData.get('email');
    const message = formData.get('message');

    if (!name || !email || !message) {
      throw new Error('All fields are required');
    }

    const response = await fetch('/api/send-email', {

      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, message }),
    });

    if (response.ok) success = true;
    else throw new Error('Failed to send email');
  } catch (err) {
    error = err.message;
  }
}
---

<Layout title="Contact">
  <ContactForm {success} {error} />
</Layout>
